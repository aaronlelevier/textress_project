{% extends "frontend/base.html" %}
{% load staticfiles stripe_tags %}

{% block page_css %}
<link rel="stylesheet" href="{% static 'clipone/frontend/clip-one/assets/plugins/flex-slider/flexslider.css' %}">
<link href="{% static 'djangular/css/styles.css' %}" rel="stylesheet" />
<link href="{% static 'djangular/css/bootstrap3.css' %}" rel="stylesheet" />
<link href="{% static 'css/djangular-demo.css' %}" rel="stylesheet" />
{% endblock page_css %}


{% block head_js %}
{{ block.super }}
<!-- stipe: start -->
<script type="text/javascript" src="https://js.stripe.com/v2/"></script>
<script type="text/javascript">
    Stripe.setPublishableKey('{{ publishable_key }}');

    var stripeResponseHandler = function(status, response) {
        var $form = $('#checkout-form');

        if (response.error) {
            // Show the errors on the form
            $form.find('.payment-errors').text(response.error.message);
            $form.find('.payment-errors').addClass('alert');
            $form.find('.payment-errors').addClass('alert-error');
            $form.find('button').prop('disabled', false);
        } else {
            // token contains id, last4, and card type
            var token = response.id;
            // Insert the token into the form so it gets submitted to the server
            $form.append($('<input type="hidden" name="stripe_token" />').val(token));
            // and re-submit
            $form.get(0).submit();
        }
    };

    jQuery(function($) {
        $('#checkout-form').submit(function(e) {
            var $form = $(this);

            // Disable the submit button to prevent repeated clicks
            $form.find('button').prop('disabled', true);

            Stripe.createToken($form, stripeResponseHandler);

            // Prevent the form from submitting with the default action
            return false;
        });
    });
</script>
<!-- stripe: end -->
{% endblock head_js %}


{% block content %}
<div class="main-container">
    <section class="wrapper padding50">
        <div class="container">
            <form method="post" action="" id="checkout-form">
                {% csrf_token %}
                <div id="wizard" class="swMain">
                    <ul>
                    {% for step in steps %}
                        <li>
                            <a href="#step-{{ forloop.counter }}">
                                <div class="stepNumber">
                                    {{ forloop.counter }}
                                </div>
                                <span class="stepDesc"> Step {{ forloop.counter }}
                                    <br />
                                    <small>{{ step }}</small> </span>
                            </a>
                        </li>
                    {% endfor %}
                    </ul>
                </div>

                <div class="progress progress-striped active progress-sm">
                    <div aria-valuemax="100" aria-valuemin="0" role="progressbar" class="progress-bar progress-bar-success step-bar">
                        <span class="sr-only"> 0% Complete (success)</span>
                    </div>
                </div>

                <div class="row">
                    <h2 class="StepTitle">{{ step }}</h2>
                </div>

                <div class="col-md-6">
                    <div class="row">
                        <h3>My Info</h3>
                        <ul class="list-unstyled">
                            <li><strong>Username:</strong> {{ user }}</li>
                            <li><strong>Email:</strong> {{ user.email }} </li>
                            <li>&nbsp;<span class="symbol required"></span><small> this will be the email used to email payment receipt.</small></li>
                        </ul>
                    </div>
                    <div class="row">
                        <h3>Hotel Info</h3>
                        <ul class="list-unstyled">
                            <li><strong>Hotel name:</strong> {{ hotel.name }}</li>
                            <li><strong>Address</strong></li>
                            <li>{{ hotel.address_line1 }}</li>
                            <li>{{ hotel.address_line2 }}</li>
                            <li>{{ hotel.address_city }}, {{ hotel.address_state }} {{ hotel.address_zip }}</li>
                            <li><strong>Phone</strong></li>
                            <li>{{ hotel.address_phone|format_phone }}</li>
                        </ul>
                    </div>
                    <div class="row">
                        <h3>Payment Plan</h3>
                        <ul class="list-unstyled">
                            <li><strong>Initial Payment:</strong> {{ acct_cost.init_amt|stripe_money }}</li>
                            <li><strong>Balance Minimum:</strong> {{ acct_cost.balance_min|stripe_money }}</li>
                            <li><strong>Recharge Amount:</strong> {{ acct_cost.recharge_amt|stripe_money }}</li>
                        </ul>
                    </div>
                </div>


                <div class="col-md-6">

                    <div class="row" style="margin-bottom:2em">
                        <span class="payment-errors alert-danger"></span>
                    </div>

                    <div class="form-group">
                      <label class="control-label" for="card">Card</label>
                      <div class="controls">
                          <input type="text" id="card" class="form-control" data-stripe="number" />
                      </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label" for="">Expiration (MM/YYYY)</label>
                        <div class="row">
                            <div class="col-xs-2">
                                <input type="text" size="2" data-stripe="exp-month" class="form-control" />
                            </div>
                            <div class="col-xs-2">
                                <input type="text" size="4" data-stripe="exp-year" class="form-control" />
                            </div>
                        </div>
                    </div>
                    <div class="form-group">
                        <label class="control-label" for="cvc">CVC</label>
                        <div class="controls">
                            <input type="text" id="cvc" size="4" class="form-control" data-stripe="cvc" />
                        </div>
                    </div>
                    <div class="form-group">
                        <div class="controls">
                            <input type="submit" value="Checkout" class="btn btn-primary" />
                        </div>
                    </div>
                </div>

            </form>
        </div>
    </section>
</div>
<!-- end: MAIN CONTAINER -->
{% endblock content %}


{% block footer %}{% endblock %}


{% block page_js %}
<script src="{% static 'clipone/admin/clip-one/assets/plugins/jquery-validation/dist/jquery.validate.min.js' %}"></script>
<script src="{% static 'clipone/admin/clip-one/assets/plugins/jQuery-Smart-Wizard/js/jquery.smartWizard.js' %}"></script>
{% endblock page_js %}


{% block init_js %}
<script>
    jQuery(document).ready(function() {
        Main.init();

    var FormWizard = function() {
        var wizardContent = $('#wizard');
        var wizardForm = $('#form');
        var initWizard = function() {
            // function to initiate Wizard Form
            wizardContent.smartWizard({
                selected : 0,
                keyNavigation : false,
            });
            var numberOfSteps = 0;
            animateBar();
        };
        var animateBar = function(val) {
            if (( typeof val == 'undefined') || val == "") {
                val = {{ step_number|add:"1" }};
            };
            numberOfSteps = $('.swMain > ul > li').length;
            var valueNow = Math.floor(100 / numberOfSteps * val);
            $('.step-bar').css('width', valueNow + '%');
        };
        return {
            init : function() {
                initWizard();
            }
        };
    }();

        FormWizard.init();
    });
</script>
{% endblock init_js %}